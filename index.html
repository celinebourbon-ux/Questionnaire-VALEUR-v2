<!DOCTYPE html>
<html lang="fr">
        <!-- Biblioth√®ques pour g√©n√©rer le PDF -->
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    </head>

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Questionnaire V.A.L.E.U.R¬©</title>
    <style>
        :root {
            --color-white: rgba(255, 255, 255, 1);
            --color-cream-50: rgba(252, 252, 249, 1);
            --color-cream-100: rgba(255, 255, 253, 1);
            --color-gray-200: rgba(245, 245, 245, 1);
            --color-gray-300: rgba(167, 169, 169, 1);
            --color-slate-500: rgba(98, 108, 113, 1);
            --color-slate-900: rgba(19, 52, 59, 1);
            --color-teal-500: rgba(33, 128, 141, 1);
            --color-teal-600: rgba(29, 116, 128, 1);
            --color-red-500: rgba(192, 21, 47, 1);
            --color-bg-1: rgba(59, 130, 246, 0.08);
            --color-bg-2: rgba(245, 158, 11, 0.08);
            --color-bg-3: rgba(34, 197, 94, 0.08);
            --color-bg-4: rgba(239, 68, 68, 0.08);
            --color-bg-5: rgba(147, 51, 234, 0.08);
            --color-bg-6: rgba(249, 115, 22, 0.08);
            --color-bg-7: rgba(236, 72, 153, 0.08);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: var(--color-cream-50);
            color: var(--color-slate-900);
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            background: linear-gradient(135deg, var(--color-teal-500), var(--color-teal-600));
            color: white;
            padding: 40px 20px;
            border-radius: 12px;
            margin-bottom: 40px;
            text-align: center;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        header p {
            font-size: 1.1em;
            opacity: 0.95;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: var(--color-gray-200);
            border-radius: 10px;
            margin: 30px 0;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: var(--color-teal-500);
            transition: width 0.3s ease;
            width: 0%;
        }

        .section {
            display: none;
            background: white;
            padding: 40px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }

        .section.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .section-title {
            font-size: 1.8em;
            color: var(--color-slate-900);
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .section-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5em;
        }

        .color-red { background: var(--color-bg-4); }
        .color-orange { background: var(--color-bg-6); }
        .color-yellow { background: var(--color-bg-2); }
        .color-green { background: var(--color-bg-3); }
        .color-blue { background: var(--color-bg-1); }
        .color-indigo { background: var(--color-bg-5); }
        .color-violet { background: var(--color-bg-7); }

        .section-subtitle {
            color: var(--color-slate-500);
            margin-bottom: 30px;
            font-size: 1.05em;
        }

        .demographics {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 40px;
            padding: 20px;
            background: var(--color-cream-100);
            border-radius: 8px;
        }

        .demographic-field {
            display: flex;
            flex-direction: column;
        }

        .demographic-field label {
            font-weight: 500;
            margin-bottom: 8px;
            color: var(--color-slate-900);
        }

        .demographic-field input,
        .demographic-field select {
            padding: 12px;
            border: 1px solid var(--color-gray-300);
            border-radius: 6px;
            font-size: 1em;
            font-family: inherit;
        }

        .item-container {
            margin-bottom: 30px;
            padding: 20px;
            background: var(--color-cream-100);
            border-radius: 8px;
            border-left: 4px solid var(--color-teal-500);
        }

        .item-number {
            font-weight: 600;
            color: var(--color-teal-600);
            margin-bottom: 8px;
            font-size: 0.95em;
        }

        .item-text {
            font-size: 1.05em;
            color: var(--color-slate-900);
            margin-bottom: 15px;
            line-height: 1.5;
        }

        .scale-container {
            display: flex;
            gap: 10px;
            justify-content: space-between;
            align-items: center;
        }

        .scale-label {
            font-size: 0.85em;
            color: var(--color-slate-500);
            text-align: center;
            flex: 1;
        }

        .scale-option {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
        }

        .scale-option input[type="radio"] {
            width: 28px;
            height: 28px;
            cursor: pointer;
            accent-color: var(--color-teal-500);
        }

        .scale-option input[type="radio"]:hover {
            transform: scale(1.2);
        }

        .buttons {
            display: flex;
            justify-content: space-between;
            gap: 20px;
            margin-top: 40px;
        }

        button {
            padding: 14px 30px;
            font-size: 1.05em;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .btn-primary {
            background: var(--color-teal-500);
            color: white;
            flex: 1;
        }

        .btn-primary:hover {
            background: var(--color-teal-600);
            box-shadow: 0 4px 12px rgba(33, 128, 141, 0.3);
        }

        .btn-primary:disabled {
            background: var(--color-gray-300);
            cursor: not-allowed;
        }

        .btn-secondary {
            background: var(--color-gray-200);
            color: var(--color-slate-900);
        }

        .btn-secondary:hover {
            background: var(--color-gray-300);
        }

        .instructions {
            background: var(--color-bg-1);
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 30px;
            border-left: 4px solid var(--color-teal-500);
        }

        .instructions h3 {
            color: var(--color-teal-600);
            margin-bottom: 10px;
        }

        .instructions p {
            margin-bottom: 8px;
            color: var(--color-slate-900);
        }

        .results-header {
            background: var(--color-teal-500);
            color: white;
            padding: 30px;
            border-radius: 12px;
            margin-bottom: 30px;
            text-align: center;
        }

        .results-header h2 {
            font-size: 2em;
            margin-bottom: 10px;
        }

        .scores-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }

        .score-card {
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            text-align: center;
            border-top: 4px solid;
        }

        .score-card h3 {
            margin-bottom: 15px;
            font-size: 1.4em;
        }

        .score-value {
            font-size: 3em;
            font-weight: bold;
            margin: 15px 0;
        }

        .score-level {
            font-size: 1.1em;
            font-weight: 600;
            margin-bottom: 10px;
        }

        .score-bar {
            width: 100%;
            height: 10px;
            background: var(--color-gray-200);
            border-radius: 5px;
            overflow: hidden;
            margin-top: 15px;
        }

        .score-bar-fill {
            height: 100%;
            transition: width 0.6s ease;
        }

        .red { background: linear-gradient(135deg, var(--color-bg-4), var(--color-red-500)); border-color: #ef4444; }
        .orange { background: linear-gradient(135deg, var(--color-bg-6), #f97316); border-color: #f97316; }
        .yellow { background: linear-gradient(135deg, var(--color-bg-2), #eab308); border-color: #eab308; }
        .green { background: linear-gradient(135deg, var(--color-bg-3), #22c55e); border-color: #22c55e; }
        .blue { background: linear-gradient(135deg, var(--color-bg-1), #3b82f6); border-color: #3b82f6; }
        .indigo { background: linear-gradient(135deg, var(--color-bg-5), #8b5cf6); border-color: #8b5cf6; }
        .violet { background: linear-gradient(135deg, var(--color-bg-7), #ec4899); border-color: #ec4899; }

        .portrait-section {
            background: white;
            padding: 30px;
            border-radius: 12px;
            margin-bottom: 30px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .portrait-section h3 {
            color: var(--color-teal-600);
            margin-bottom: 15px;
            font-size: 1.4em;
        }

        .portrait-text {
            color: var(--color-slate-900);
            line-height: 1.8;
            margin-bottom: 15px;
        }

        .critical-items {
            background: var(--color-bg-4);
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
            border-left: 4px solid var(--color-red-500);
        }

        .critical-items h4 {
            color: var(--color-red-500);
            margin-bottom: 10px;
        }

        .critical-items ul {
            list-style: none;
            padding-left: 0;
        }

        .critical-items li {
            padding: 8px 0;
            color: var(--color-slate-900);
        }

        .critical-items li:before {
            content: "‚ö† ";
            color: var(--color-red-500);
            font-weight: bold;
            margin-right: 8px;
        }

        .resources-items {
            background: var(--color-bg-3);
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
            border-left: 4px solid #22c55e;
        }

        .resources-items h4 {
            color: #22c55e;
            margin-bottom: 10px;
        }

        .resources-items ul {
            list-style: none;
            padding-left: 0;
        }

        .resources-items li {
            padding: 8px 0;
            color: var(--color-slate-900);
        }

        .resources-items li:before {
            content: "‚úì ";
            color: #22c55e;
            font-weight: bold;
            margin-right: 8px;
        }

        .phase {
            margin: 15px 0;
            padding: 15px;
            background: white;
            border-radius: 8px;
            border-left: 4px solid var(--color-teal-500);
        }

        .phase-title {
            font-weight: 600;
            color: var(--color-teal-600);
            margin-bottom: 8px;
        }

        .phase-content {
            color: var(--color-slate-900);
            font-size: 0.95em;
        }

        .export-buttons {
            display: flex;
            gap: 15px;
            margin-top: 30px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .btn-export {
            padding: 12px 25px;
            background: var(--color-teal-500);
            color: white;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            border: none;
        }

        .btn-export:hover {
            background: var(--color-teal-600);
            box-shadow: 0 4px 12px rgba(33, 128, 141, 0.3);
        }

        @media (max-width: 768px) {
            .demographics {
                grid-template-columns: 1fr;
            }

            header h1 {
                font-size: 1.8em;
            }

            .scores-grid {
                grid-template-columns: 1fr;
            }

            .scale-container {
                flex-wrap: wrap;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üé≠ M√©thode V.A.L.E.U.R¬©</h1>
            <header>
                <h1>üé≠ Questionnaire V.A.L.E.U.R¬©</h1>
                <p>Identification des Strat√©gies de Protection Psychologique</p>
            </header>


        <div class="progress-bar">
            <div class="progress-fill"></div>
        </div>

        <div class="section active" id="section-welcome">
            <h2 style="text-align: center; margin-bottom: 30px;">Bienvenue</h2>
            <div class="instructions">
                <h3>üìã √Ä propos de ce questionnaire</h3>
                <p>Ce questionnaire explore les <strong>7 masques psychologiques</strong> que nous d√©veloppons pour nous prot√©ger face aux blessures √©motionnelles.</p>
                <p>Chaque masque correspond √† une peur primale et une strat√©gie d'adaptation sp√©cifique.</p>
                <p><strong>Dur√©e estim√©e:</strong> 40 √† 50 minutes</p>
            </div>

            <div class="demographics">
                <div class="demographic-field">
                    <label for="prenom">Pr√©nom / Initiales (confidentiel):</label>
                    <input type="text" id="prenom" placeholder="Ex: J.D.">
                </div>
                <div class="demographic-field">
                    <label for="age">√Çge:</label>
                    <input type="number" id="age" min="18" max="120">
                </div>
                <div class="demographic-field">
                    <label for="genre">Genre:</label>
                    <select id="genre">
                        <option value="">-- S√©lectionner --</option>
                        <option value="feminin">F√©minin</option>
                        <option value="masculin">Masculin</option>
                        <option value="autre">Autre</option>
                        <option value="prefer">Pr√©f√®re ne pas dire</option>
                    </select>
                </div>
                <div class="demographic-field">
                    <label for="situation">Situation professionnelle:</label>
                    <select id="situation">
                        <option value="">-- S√©lectionner --</option>
                        <option value="salarie">Salari√©(e)</option>
                        <option value="independant">Ind√©pendant(e)</option>
                        <option value="sans-emploi">Sans emploi</option>
                        <option value="etudiant">√âtudiant(e)</option>
                        <option value="retraite">Retrait√©(e)</option>
                    </select>
                </div>
                <div class="demographic-field">
                    <label for="attachement">Style d'attachement pr√©sum√©:</label>
                    <select id="attachement">
                        <option value="">-- S√©lectionner --</option>
                        <option value="securise">S√©curis√©</option>
                        <option value="anxieux">Anxieux-ambivalent</option>
                        <option value="evitant">√âvitant</option>
                        <option value="desorganise">D√©sorganis√©</option>
                        <option value="incertain">Incertain</option>
                    </select>
                </div>
            </div>

            <div class="buttons">
                <button class="btn-primary" onclick="startQuestionnaire()">Commencer le questionnaire ‚Üí</button>
            </div>
        </div>

        <div class="section" id="section-red">
            <div class="section-title">
                <div class="section-icon color-red">üî¥</div>
                <div>
                    <div>MASQUE ROUGE</div>
                    <div style="font-size: 0.7em; color: var(--color-slate-500);">Anxi√©t√© de Sant√© ‚Ä¢ Hypervigilance Somatique ‚Ä¢ Peur Existentielle</div>
                </div>
            </div>
            <p class="section-subtitle">Surveilles-tu constamment ta sant√© ou tes sensations corporelles?</p>
            <div id="items-red"></div>
            <div class="buttons">
                <button class="btn-secondary" onclick="previousSection()">‚Üê Retour</button>
                <button class="btn-primary" onclick="nextSection()">Suivant ‚Üí</button>
            </div>
        </div>

        <div class="section" id="section-orange">
            <div class="section-title">
                <div class="section-icon color-orange">üü†</div>
                <div>
                    <div>MASQUE ORANGE</div>
                    <div style="font-size: 0.7em; color: var(--color-slate-500);">Alexithymie ‚Ä¢ √âvitement √âmotionnel ‚Ä¢ Dissociation Affective</div>
                </div>
            </div>
            <p class="section-subtitle">√âprouves-tu des difficult√©s √† identifier ou exprimer tes √©motions?</p>
            <div id="items-orange"></div>
            <div class="buttons">
                <button class="btn-secondary" onclick="previousSection()">‚Üê Retour</button>
                <button class="btn-primary" onclick="nextSection()">Suivant ‚Üí</button>
            </div>
        </div>

        <div class="section" id="section-yellow">
            <div class="section-title">
                <div class="section-icon color-yellow">üü°</div>
                <div>
                    <div>MASQUE JAUNE</div>
                    <div style="font-size: 0.7em; color: var(--color-slate-500);">Intol√©rance √† l'Incertitude ‚Ä¢ Besoin de Contr√¥le ‚Ä¢ Rigidit√© Cognitive</div>
                </div>
            </div>
            <p class="section-subtitle">Planifies-tu excessivement et as-tu du mal avec l'impr√©vu?</p>
            <div id="items-yellow"></div>
            <div class="buttons">
                <button class="btn-secondary" onclick="previousSection()">‚Üê Retour</button>
                <button class="btn-primary" onclick="nextSection()">Suivant ‚Üí</button>
            </div>
        </div>

        <div class="section" id="section-green">
            <div class="section-title">
                <div class="section-icon color-green">üü¢</div>
                <div>
                    <div>MASQUE VERT</div>
                    <div style="font-size: 0.7em; color: var(--color-slate-500);">Anxi√©t√© de S√©paration ‚Ä¢ D√©pendance Affective ‚Ä¢ Peur de l'Abandon</div>
                </div>
            </div>
            <p class="section-subtitle">Crains-tu le rejet et as-tu du mal √† affirmer tes besoins?</p>
            <div id="items-green"></div>
            <div class="buttons">
                <button class="btn-secondary" onclick="previousSection()">‚Üê Retour</button>
                <button class="btn-primary" onclick="nextSection()">Suivant ‚Üí</button>
            </div>
        </div>

        <div class="section" id="section-blue">
            <div class="section-title">
                <div class="section-icon color-blue">üîµ</div>
                <div>
                    <div>MASQUE BLEU</div>
                    <div style="font-size: 0.7em; color: var(--color-slate-500);">Hypercontr√¥le ‚Ä¢ Besoin de Domination ‚Ä¢ Intol√©rance √† la D√©pendance</div>
                </div>
            </div>
            <p class="section-subtitle">√âprouves-tu un besoin de contr√¥le et de domination?</p>
            <div id="items-blue"></div>
            <div class="buttons">
                <button class="btn-secondary" onclick="previousSection()">‚Üê Retour</button>
                <button class="btn-primary" onclick="nextSection()">Suivant ‚Üí</button>
            </div>
        </div>

        <div class="section" id="section-indigo">
            <div class="section-title">
                <div class="section-icon color-indigo">üü£</div>
                <div>
                    <div>MASQUE INDIGO</div>
                    <div style="font-size: 0.7em; color: var(--color-slate-500);">Perfectionnisme ‚Ä¢ Syndrome de l'Imposteur ‚Ä¢ Peur de l'Inad√©quation</div>
                </div>
            </div>
            <p class="section-subtitle">Doutes-tu de ta comp√©tence malgr√© tes succ√®s?</p>
            <div id="items-indigo"></div>
            <div class="buttons">
                <button class="btn-secondary" onclick="previousSection()">‚Üê Retour</button>
                <button class="btn-primary" onclick="nextSection()">Suivant ‚Üí</button>
            </div>
        </div>

        <div class="section" id="section-violet">
            <div class="section-title">
                <div class="section-icon color-violet">‚ö´</div>
                <div>
                    <div>MASQUE VIOLET</div>
                    <div style="font-size: 0.7em; color: var(--color-slate-500);">Ali√©nation Identitaire ‚Ä¢ Faux-Self ‚Ä¢ Crise Existentielle</div>
                </div>
            </div>
            <p class="section-subtitle">Ne sais-tu plus qui tu es vraiment?</p>
            <div id="items-violet"></div>
            <div class="buttons">
                <button class="btn-secondary" onclick="previousSection()">‚Üê Retour</button>
                <button class="btn-primary" onclick="finishQuestionnaire()">Voir mes r√©sultats ‚Üí</button>
            </div>
        </div>

        <div class="section" id="section-results">
            <div class="results-header">
                <h2>üìä Vos R√©sultats Personnalis√©s</h2>
                <p id="result-date"></p>
            </div>

            <div class="scores-grid" id="scores-container"></div>

            <div class="portrait-section">
                <h3>üéØ Votre Portrait Psychologique Global</h3>
                <div id="portrait-global"></div>
            </div>

            <div class="portrait-section">
                <h3>‚ö†Ô∏è Domaines Prioritaires d'Intervention</h3>
                <div id="critical-analysis"></div>
            </div>

            <div class="portrait-section">
                <h3>üí™ Vos Ressources Existantes</h3>
                <div id="resources-analysis"></div>
            </div>

            <div class="portrait-section">
                <h3>üõ§Ô∏è Plan Th√©rapeutique Recommand√©</h3>
                <div id="therapeutic-plan"></div>
            </div>

            <div class="portrait-section">
                <h3>üìà Interpr√©tations D√©taill√©es par Masque</h3>
                <div id="detailed-interpretations"></div>
            </div>

            <div class="export-buttons">
                <button class="btn-export" onclick="exportPDF()">üìÑ T√©l√©charger le rapport PDF</button>

                <button class="btn-export" onclick="resetQuestionnaire()">üîÑ Recommencer</button>
            </div>
        </div>
    </div>

    <script>
        const questionnaire = {
            red: {
                name: "MASQUE ROUGE",
                color: "red",
                fear: "La mort / Maladie",
                items: [
                    { id: "R1", text: "Je surveille constamment mes battements cardiaques, ma respiration ou ma temp√©rature corporelle", inverted: false },
                    { id: "R_inv1", text: "Je fais confiance √† mon corps et √† sa capacit√© autor√©gulative de maintien de la sant√©", inverted: true },
                    { id: "R2", text: "Lorsque je ressens une sensation corporelle inhabituelle, j'anticipe imm√©diatement le pire diagnostic", inverted: false },
                    { id: "R_inv2", text: "Lorsque je ressens une sensation physique mineure, j'√©value qu'elle est probablement b√©nigne", inverted: true },
                    { id: "R3", text: "Je recherche mes sympt√¥mes en ligne ou consulte des sources m√©dicales pour auto-diagnostiquer mes maux", inverted: false },
                    { id: "R_inv3", text: "Je peux pratiquer une activit√© physique sans pr√©occupation excessive concernant ma sant√©", inverted: true },
                    { id: "R4", text: "J'√©vite certaines activit√©s physiques (escaliers, sport, transports) par appr√©hension qu'un √©v√©nement grave survienne", inverted: false },
                    { id: "R_inv4", text: "Je suis rarement pr√©occup√©(e) par ma sant√© ou par l'√©mergence potentielle de pathologies", inverted: true },
                    { id: "R5", text: "Je me r√©veille la nuit avec une angoisse concernant ma sant√© ou mon int√©grit√© physique", inverted: false },
                    { id: "R6", text: "J'ai besoin d'une r√©assurance r√©p√©t√©e de professionnels m√©dicaux ou de mes proches concernant ma sant√©", inverted: false },
                    { id: "R7", text: "La moindre douleur corporelle d√©clenche imm√©diatement des pens√©es de maladie grave (cancer, infarctus, AVC)", inverted: false },
                    { id: "R8", text: "J'ai consult√© plusieurs m√©decins pour un m√™me sympt√¥me car aucune r√©assurance n'a √©t√© suffisante", inverted: false },
                    { id: "R9", text: "J'√©prouve une peur r√©currente de mourir subitement (arr√™t cardiaque, accident vasculaire) sans signe avant-coureur", inverted: false },
                    { id: "R10", text: "Je r√©alise des bilans de sant√© tr√®s r√©guliers, m√™me en l'absence de symptomatologie particuli√®re", inverted: false },
                    { id: "R11", text: "Les reportages ou informations sur des pathologies graves me concernent personnellement et g√©n√®rent de l'anxi√©t√©", inverted: false },
                    { id: "R12", text: "J'ai des difficult√©s de concentration car mon attention est capt√©e par mes sensations corporelles", inverted: false }
                ]
            },
            orange: {
                name: "MASQUE ORANGE",
                color: "orange",
                fear: "La douleur / Souffrance",
                items: [
                    { id: "O1", text: "Je change de sujet ou me retire lorsqu'une conversation devient trop charg√©e √©motionnellement", inverted: false },
                    { id: "O_inv1", text: "Je ressens et identifie clairement mes diff√©rents √©tats √©motionnels", inverted: true },
                    { id: "O2", text: "Je ressens un malaise significatif lorsqu'autrui pleure ou exprime des √©motions intenses en ma pr√©sence", inverted: false },
                    { id: "O_inv2", text: "L'intimit√© √©motionnelle avec autrui me semble naturelle et confortable", inverted: true },
                    { id: "O3", text: "J'√©prouve des difficult√©s √† identifier et nommer pr√©cis√©ment ce que je ressens (peur, col√®re, tristesse, joie)", inverted: false },
                    { id: "O_inv3", text: "J'ai pleur√© r√©cemment et ai pu exprimer authentiquement ce que je ressentais", inverted: true },
                    { id: "O4", text: "Je maintiens un niveau d'activit√© constant pour √©viter de me retrouver seul(e) avec mes √©motions", inverted: false },
                    { id: "O_inv4", text: "Mon corps me semble vivant, habit√© et connect√© √† mes √©motions", inverted: true },
                    { id: "O5", text: "J'utilise l'humour ou la d√©rision comme m√©canisme d'√©vitement face aux situations √©motionnellement difficiles", inverted: false },
                    { id: "O6", text: "Je me sens √©motionnellement engourdi(e), comme si j'observais ma propre vie de l'ext√©rieur", inverted: false },
                    { id: "O7", text: "J'√©vite d√©lib√©r√©ment les films, lectures ou situations susceptibles de m'√©mouvoir intens√©ment", inverted: false },
                    { id: "O8", text: "Je n'ai pas pleur√© depuis une p√©riode prolong√©e, m√™me lors d'√©v√©nements objectivement difficiles", inverted: false },
                    { id: "O9", text: "Je minimise syst√©matiquement mes difficult√©s en r√©pondant ¬´ √ßa va ¬ª m√™me en situation de d√©tresse", inverted: false },
                    { id: "O10", text: "J'utilise le travail, les substances, les √©crans ou d'autres activit√©s pour anesth√©sier mes ressentis", inverted: false },
                    { id: "O11", text: "Mon entourage me per√ßoit comme √©motionnellement distant(e), froid(e) ou manquant d'empathie", inverted: false },
                    { id: "O12", text: "Je me sens d√©connect√©(e) de mon corps et de ses manifestations sensorielles", inverted: false }
                ]
            },
            yellow: {
                name: "MASQUE JAUNE",
                color: "yellow",
                fear: "L'inconnu / Incertitude",
                items: [
                    { id: "J1", text: "Je planifie excessivement chaque aspect de mon existence pour anticiper et pr√©venir les impr√©vus", inverted: false },
                    { id: "J_inv1", text: "J'appr√©cie l'impr√©vu et les surprises, m√™me lorsqu'elles sont inattendues", inverted: true },
                    { id: "J2", text: "L'incertitude ou l'absence d'information sur ce qui va advenir g√©n√®re une anxi√©t√© consid√©rable", inverted: false },
                    { id: "J_inv2", text: "Je peux prendre des d√©cisions sans disposer de toutes les informations", inverted: true },
                    { id: "J3", text: "Je v√©rifie de mani√®re r√©p√©t√©e mes actions (fermetures, appareils, communications) pour m'assurer de leur exactitude", inverted: false },
                    { id: "J_inv3", text: "Je suis flexible et peux ais√©ment adapter mes plans face aux circonstances", inverted: true },
                    { id: "J4", text: "Les modifications de planification ou d'horaire, m√™me mineures, d√©clenchent un stress significatif", inverted: false },
                    { id: "J_inv4", text: "L'incertitude ne constitue pas une source d'anxi√©t√© significative pour moi", inverted: true },
                    { id: "J5", text: "J'ai d√©velopp√© des routines rigides et leur modification me perturbe profond√©ment", inverted: false },
                    { id: "J6", text: "Je rumine constamment sur l'ensemble des sc√©narios possibles et leurs cons√©quences potentielles", inverted: false },
                    { id: "J7", text: "J'ai besoin d'une quantit√© importante d'informations avant de prendre m√™me une d√©cision mineure", inverted: false },
                    { id: "J8", text: "Les surprises, m√™me positives ou agr√©ables, g√©n√®rent un inconfort psychologique", inverted: false },
                    { id: "J9", text: "Je pr√©pare syst√©matiquement plusieurs plans alternatifs (B, C, D) pour toute situation", inverted: false },
                    { id: "J10", text: "Les environnements nouveaux ou peu pr√©visibles d√©clenchent une anxi√©t√© intense", inverted: false },
                    { id: "J11", text: "Je suis tr√®s rigide dans mes m√©thodes et r√©siste √† l'exp√©rimentation de nouvelles approches", inverted: false },
                    { id: "J12", text: "L'id√©e d'improviser ou d'adopter une posture de ¬´ on verra bien ¬ª m'angoisse profond√©ment", inverted: false }
                ]
            },
            green: {
                name: "MASQUE VERT",
                color: "green",
                fear: "Le rejet / Abandon",
                items: [
                    { id: "V1", text: "J'acquiesce √† la majorit√© des demandes, m√™me lorsque je n'en ai authentiquement pas l'envie", inverted: false },
                    { id: "V_inv1", text: "Je peux affirmer mes besoins authentiques sans crainte excessive du rejet", inverted: true },
                    { id: "V2", text: "Un message sans r√©ponse rapide d√©clenche une anxi√©t√© et une rumination importantes", inverted: false },
                    { id: "V_inv2", text: "Je suis √† l'aise et serein(e) dans la solitude", inverted: true },
                    { id: "V3", text: "J'adapte ma personnalit√©, mes opinions et mes pr√©f√©rences en fonction de mon interlocuteur", inverted: false },
                    { id: "V_inv3", text: "Je sais poser des limites et dire ¬´ non ¬ª lorsque quelque chose ne me convient pas", inverted: true },
                    { id: "V4", text: "Je suis incapable d'affirmer mes besoins ou d√©sirs authentiques par crainte de g√©n√©rer un conflit", inverted: false },
                    { id: "V_inv4", text: "Je me sens aim√©(e) et accept√©(e) pour qui je suis authentiquement", inverted: true },
                    { id: "V5", text: "J'ai besoin d'une r√©assurance constante concernant l'affection et l'acceptation d'autrui √† mon √©gard", inverted: false },
                    { id: "V6", text: "Je maintiens des relations insatisfaisantes ou d√©l√©t√®res par peur de me retrouver seul(e)", inverted: false },
                    { id: "V7", text: "Je me surcharge de responsabilit√©s pour me rendre indispensable et garantir ma place", inverted: false },
                    { id: "V8", text: "La solitude repr√©sente une terreur profonde et je d√©ploie tous les moyens pour l'√©viter", inverted: false },
                    { id: "V9", text: "J'analyse constamment les comportements d'autrui √† la recherche d'indices de rejet potentiel", inverted: false },
                    { id: "V10", text: "J'√©prouve des difficult√©s majeures √† exprimer un d√©saccord ou une perspective divergente par peur du jugement", inverted: false },
                    { id: "V11", text: "Je m'efface syst√©matiquement et sacrifie mes propres besoins pour le confort relationnel d'autrui", inverted: false },
                    { id: "V12", text: "Une critique, m√™me constructive, me blesse profond√©ment et je la rumine longuement", inverted: false }
                ]
            },
            blue: {
                name: "MASQUE BLEU",
                color: "blue",
                fear: "L'impuissance",
                items: [
                    { id: "B1", text: "Je reprends imm√©diatement le contr√¥le ou corrige autrui lorsque les choses sont r√©alis√©es diff√©remment", inverted: false },
                    { id: "B_inv1", text: "Je peux facilement d√©l√©guer et faire confiance aux comp√©tences d'autrui", inverted: true },
                    { id: "B2", text: "D√©l√©guer m'est extr√™mement difficile car je suis convaincu(e) qu'autrui ne fera pas aussi bien", inverted: false },
                    { id: "B_inv2", text: "Lorsque les √©v√©nements m'√©chappent, je maintiens ma s√©r√©nit√© int√©rieure", inverted: true },
                    { id: "B3", text: "Je ressens une irritation visc√©rale et profonde lorsque les √©v√©nements m'√©chappent", inverted: false },
                    { id: "B_inv3", text: "J'accueille les critiques et les perspectives divergentes avec ouverture", inverted: true },
                    { id: "B4", text: "J'ai des r√©actions de col√®re disproportionn√©es face √† la perte de contr√¥le d'une situation", inverted: false },
                    { id: "B_inv4", text: "Je n'ai pas besoin d'√™tre en position dominante ou de contr√¥le pour me sentir en s√©curit√©", inverted: true },
                    { id: "B5", text: "Je suis tr√®s susceptible et r√©agis intens√©ment √† toute forme de critique, m√™me constructive", inverted: false },
                    { id: "B6", text: "J'ai un besoin significatif d'√™tre reconnu(e), admir√©(e) ou d'occuper une position d'influence", inverted: false },
                    { id: "B7", text: "Je ressens une anxi√©t√© majeure ou un sentiment d'impuissance lorsque je dois d√©pendre d'autrui", inverted: false },
                    { id: "B8", text: "Je tends √† diriger, organiser et prendre les d√©cisions pour les autres, m√™me sans sollicitation", inverted: false },
                    { id: "B9", text: "Mon entourage me d√©crit comme contr√¥lant(e), directif(ve) ou difficile dans les relations", inverted: false },
                    { id: "B10", text: "Je tol√®re tr√®s difficilement qu'on me dicte ma conduite ou mes choix", inverted: false },
                    { id: "B11", text: "J'√©puise mon entourage en portant l'ensemble des responsabilit√©s et en refusant l'aide", inverted: false },
                    { id: "B12", text: "L'id√©e d'√™tre dans une position d'impuissance ou sans influence me terrifie profond√©ment", inverted: false }
                ]
            },
            indigo: {
                name: "MASQUE INDIGO",
                color: "indigo",
                fear: "L'√©chec / Insuffisance",
                items: [
                    { id: "I1", text: "Je procrastine ou diff√®re mes actions par crainte que mon travail ne soit pas suffisamment parfait", inverted: false },
                    { id: "I_inv1", text: "Je reconnais et valorise mes accomplissements avec fiert√©", inverted: true },
                    { id: "I2", text: "Je minimise syst√©matiquement mes accomplissements et mes succ√®s", inverted: false },
                    { id: "I_inv2", text: "Je peux entreprendre de nouvelles activit√©s m√™me sans garantie de perfection", inverted: true },
                    { id: "I3", text: "J'√©prouve le sentiment profond d'√™tre un(e) imposteur(e) qui a b√©n√©fici√© de chance jusqu'√† pr√©sent", inverted: false },
                    { id: "I_inv3", text: "Je me sens comp√©tent(e) et l√©gitime dans mes domaines d'expertise", inverted: true },
                    { id: "I4", text: "Je me compare constamment √† autrui et me per√ßois toujours comme inf√©rieur(e) ou insuffisant(e)", inverted: false },
                    { id: "I_inv4", text: "Une erreur repr√©sente pour moi une opportunit√© d'apprentissage, non une remise en cause de ma valeur", inverted: true },
                    { id: "I5", text: "Je retravaille excessivement mes productions car elles ne sont jamais assez abouties pour √™tre partag√©es", inverted: false },
                    { id: "I6", text: "J'√©vite de relever des d√©fis, de prendre des initiatives ou d'exp√©rimenter de nouvelles comp√©tences", inverted: false },
                    { id: "I7", text: "Une erreur mineure me fait intens√©ment douter de ma comp√©tence globale et de ma valeur", inverted: false },
                    { id: "I8", text: "J'ai un besoin constant de validation externe pour me sentir comp√©tent(e) et l√©gitime", inverted: false },
                    { id: "I9", text: "Je sabote inconsciemment mes propres r√©ussites lorsqu'elles deviennent trop significatives", inverted: false },
                    { id: "I10", text: "La perspective de d√©cevoir autrui me paralyse et m'emp√™che d'agir", inverted: false },
                    { id: "I11", text: "Mon dialogue interne est s√©v√®rement critique, punitif et auto-flagellant", inverted: false },
                    { id: "I12", text: "Je pr√©f√®re ne rien entreprendre plut√¥t que de risquer un √©chec visible publiquement", inverted: false }
                ]
            },
            violet: {
                name: "MASQUE VIOLET",
                color: "violet",
                fear: "Perdre son Identit√©",
                items: [
                    { id: "Vi1", text: "Je ne sais plus v√©ritablement qui je suis en dehors des r√¥les sociaux que j'incarne", inverted: false },
                    { id: "Vi_inv1", text: "Je sais clairement qui je suis ind√©pendamment des r√¥les que je joue socialement", inverted: true },
                    { id: "Vi2", text: "Lorsque je suis seul(e) et silencieux(se), j'√©prouve un vide, une absence ou un manque de sens", inverted: false },
                    { id: "Vi_inv2", text: "Je me sens vivant(e), pr√©sent(e) et pleinement impliqu√©(e) dans ma propre vie", inverted: true },
                    { id: "Vi3", text: "J'ai renonc√© √† mes passions, aspirations et int√©r√™ts authentiques pour correspondre aux attentes externes", inverted: false },
                    { id: "Vi_inv3", text: "J'explore librement de nouvelles facettes de ma personnalit√© avec curiosit√©", inverted: true },
                    { id: "Vi4", text: "Si je changeais profond√©ment, je serais dans l'incapacit√© d'anticiper qui je deviendrais", inverted: false },
                    { id: "Vi_inv4", text: "Mon existence me semble authentique, coh√©rente et v√©ritablement MIENNE", inverted: true },
                    { id: "Vi5", text: "J'√©prouve une nostalgie douloureuse de qui j'√©tais ant√©rieurement, plus spontan√©(e) et authentique", inverted: false },
                    { id: "Vi6", text: "Je me sens √©tranger(√®re) √† ma propre existence, comme si je l'observais de l'ext√©rieur", inverted: false },
                    { id: "Vi7", text: "J'ai port√© tant de masques que l'id√©e d'√™tre authentiquement moi-m√™me semble terrifiante", inverted: false },
                    { id: "Vi8", text: "Je m'accroche rigidement √† mes habitudes et routines m√™me si elles ne g√©n√®rent pas de bien-√™tre", inverted: false },
                    { id: "Vi9", text: "L'id√©e d'explorer de nouvelles facettes identitaires ou de me transformer me terrifie profond√©ment", inverted: false },
                    { id: "Vi10", text: "Je vis en mode automatique, sans v√©ritable pr√©sence, choix conscient ou implication √©motionnelle", inverted: false },
                    { id: "Vi11", text: "Je refuse activement les opportunit√©s de croissance personnelle ou de transformation par peur", inverted: false },
                    { id: "Vi12", text: "Je me sens enferm√©(e) dans ma propre construction identitaire, incapable de changer v√©ritablement", inverted: false }
                ]
            }
        };

        let currentSection = "welcome";
        let responses = {};

        function initializeQuestionnaire() {
            Object.keys(questionnaire).forEach(maskKey => {
                const mask = questionnaire[maskKey];
                const container = document.getElementById(`items-${maskKey}`);

                mask.items.forEach((item, index) => {
                    const itemHTML = `
                        <div class="item-container">
                            <div class="item-number">${item.id}</div>
                            <div class="item-text">${item.text}</div>
                            <div class="scale-container">
                                <span class="scale-label">Jamais</span>
                                ${[0,1,2,3,4].map(val => `
                                    <div class="scale-option">
                                        <input type="radio" name="${item.id}" value="${val}" onchange="recordResponse('${item.id}', ${val}, ${item.inverted})">
                                        <span class="scale-label">${val}</span>
                                    </div>
                                `).join('')}
                                <span class="scale-label">Tr√®s souvent</span>
                            </div>
                        </div>
                    `;
                    container.innerHTML += itemHTML;
                });
            });
        }

        function recordResponse(itemId, value, inverted) {
            responses[itemId] = { value: parseInt(value), inverted: inverted };
            updateProgress();
        }

        function updateProgress() {
            const totalItems = Object.keys(questionnaire).reduce((sum, key) => sum + questionnaire[key].items.length, 0);
            const answered = Object.keys(responses).length;
            const percentage = (answered / totalItems) * 100;
            document.querySelector('.progress-fill').style.width = percentage + '%';
        }

        function startQuestionnaire() {
            const prenom = document.getElementById('prenom').value;
            if (!prenom) {
                alert('Veuillez entrer vos initiales');
                return;
            }
            showSection('red');
        }

        function showSection(sectionId) {
            document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
            document.getElementById(`section-${sectionId}`).classList.add('active');
            currentSection = sectionId;
            window.scrollTo(0, 0);
        }

        function nextSection() {
            const sections = ['red', 'orange', 'yellow', 'green', 'blue', 'indigo', 'violet'];
            const currentIndex = sections.indexOf(currentSection);
            if (currentIndex < sections.length - 1) {
                showSection(sections[currentIndex + 1]);
            }
        }

        function previousSection() {
            const sections = ['red', 'orange', 'yellow', 'green', 'blue', 'indigo', 'violet'];
            const currentIndex = sections.indexOf(currentSection);
            if (currentIndex > 0) {
                showSection(sections[currentIndex - 1]);
            } else {
                showSection('welcome');
            }
        }

        function finishQuestionnaire() {
            const totalItems = Object.keys(questionnaire).reduce((sum, key) => sum + questionnaire[key].items.length, 0);
            if (Object.keys(responses).length < totalItems) {
                alert(`Veuillez r√©pondre √† toutes les questions (${Object.keys(responses).length}/${totalItems})`);
                return;
            }
            calculateAndDisplayResults();
        }

        function calculateScores() {
            const scores = {};

            Object.keys(questionnaire).forEach(maskKey => {
                let score = 0;
                questionnaire[maskKey].items.forEach(item => {
                    if (responses[item.id]) {
                        let value = responses[item.id].value;
                        if (responses[item.id].inverted) {
                            value = 4 - value;
                        }
                        score += value;
                    }
                });
                scores[maskKey] = score;
            });

            return scores;
        }

        function getScoreLevel(score) {
            if (score <= 16) return { level: "Faible", color: "#22c55e" };
            if (score <= 32) return { level: "Mod√©r√©", color: "#eab308" };
            if (score <= 48) return { level: "√âlev√©", color: "#f97316" };
            return { level: "Dominant", color: "#ef4444" };
        }

        function getMaskInterpretation(maskKey, score) {
            const interpretations = {
                red: {
                    low: "Vous maintenez une relation √©quilibr√©e avec votre corps et votre sant√©. Les sensations physiques ne d√©clenchent pas d'inqui√©tude chronique.",
                    moderate: "Vous avez une vigilance normale √† votre sant√©, mais certaines situations d√©clenchent une inqui√©tude accrue. Cette vigilance est adaptative si elle ne vous immobilise pas.",
                    high: "Vous avez une surveillance constante de votre corps qui g√©n√®re une anxi√©t√© significative. Les sensations mineures sont interpr√©t√©es comme des signes de maladie grave.",
                    dominant: "L'anxi√©t√© sant√© envahit votre vie quotidienne de fa√ßon p√©nalisante. Vous avez probablement consult√© plusieurs m√©decins sans trouver de r√©assurance durable."
                },
                orange: {
                    low: "Vous avez une bonne capacit√© d'identification et d'expression √©motionnelle. L'intimit√© affective vous est accessible et confortable.",
                    moderate: "Vous avez une capacit√© √©motionnelle variable selon le contexte. Certaines √©motions sont faciles d'acc√®s, d'autres bloqu√©es.",
                    high: "Vous avez des difficult√©s significatives √† identifier et nommer vos √©motions. Il y a une d√©connexion entre ce que vous ressentez physiquement et votre conscience.",
                    dominant: "Vous avez une dissociation affective majeure : sentiment de vide, d'engourdissement. Vous observez votre vie comme de l'ext√©rieur, sans vraie connexion."
                },
                yellow: {
                    low: "Vous tol√©rez bien l'incertitude et l'impr√©vu. Vous pouvez prendre des d√©cisions sans avoir toutes les informations.",
                    moderate: "Vous avez une pr√©f√©rence pour la clart√© et l'ordre, mais vous √™tes adaptable. Les impr√©visibilit√©s cr√©ent un certain inconfort qui reste g√©rable.",
                    high: "Vous avez un besoin marqu√© de pr√©visibilit√© et de contr√¥le de l'environnement. L'incertitude g√©n√®re une anxi√©t√© significative qui pousse √† sur-planifier.",
                    dominant: "Vous √™tes dans un hypercontr√¥le cognitif et comportemental constant. Chaque d√©cision est paralysante faute d'informations suffisantes."
                },
                green: {
                    low: "Vous pouvez affirmer vos besoins sans crainte excessive du rejet. Vous maintenez des limites saines dans vos relations.",
                    moderate: "Vous avez une certaine capacit√© √† affirmer vos besoins, mais cela g√©n√®re de l'inconfort. Vous avez tendance √† sur-adapter parfois.",
                    high: "Vous avez des difficult√©s significatives √† affirmer vos besoins. La peur du rejet domine vos comportements relationnels.",
                    dominant: "Vous avez une d√©pendance affective majeure. La solitude repr√©sente une terreur profonde et vous sacrifiez vos propres besoins pour maintenir les relations."
                },
                blue: {
                    low: "Vous tol√©rez facilement les situations o√π vous n'avez pas le contr√¥le. Vous faites confiance aux comp√©tences d'autrui.",
                    moderate: "Vous avez un besoin mod√©r√© de contr√¥le. Vous aimeriez que les choses se fassent selon vos pr√©f√©rences, mais vous √™tes adaptable.",
                    high: "Vous avez un besoin marqu√© de contr√¥le. La d√©l√©gation vous est difficile et la perte de contr√¥le g√©n√®re de la frustration.",
                    dominant: "Vous √™tes dans un besoin compulsif de contr√¥le et de domination. La perte de contr√¥le cr√©e de l'irritation visc√©rale et vous tol√©rez mal l'impuissance."
                },
                indigo: {
                    low: "Vous avez une estime de vous √©quilibr√©e. Vous acceptez les erreurs comme des opportunit√©s d'apprentissage.",
                    moderate: "Vous avez certains standards √©lev√©s, mais ils restent adapt√©s √† la r√©alit√©. Vous doutez parfois mais vous pouvez avancer.",
                    high: "Vous avez des standards irr√©alistes qui vous paralysent. Le perfectionnisme est une source majeure de souffrance.",
                    dominant: "Vous avez un perfectionnisme extr√™me coupl√© au syndrome de l'imposteur. Vous sabotez vos propres succ√®s et doutez chroniquement de votre l√©gitimit√©."
                },
                violet: {
                    low: "Vous avez une identit√© claire et authentique. Vous savez qui vous √™tes ind√©pendamment de vos r√¥les sociaux.",
                    moderate: "Vous avez g√©n√©ralement une identit√© stable, mais parfois vous questionnez qui vous √™tes vraiment.",
                    high: "Vous avez des doutes significatifs sur votre identit√©. Vous sentez que vous jouez des r√¥les plut√¥t que d'√™tre authentique.",
                    dominant: "Vous avez une ali√©nation identitaire majeure. Vous ne savez plus qui vous √™tes vraiment et vous vivez en mode automatique."
                }
            };

            const level = getScoreLevel(score).level.toLowerCase().replace(/√©|√®/g, 'e');
            const key = level === "faible" ? "low" : level === "modere" ? "moderate" : level === "eleve" ? "high" : "dominant";
            return interpretations[maskKey][key];
        }

        function calculateAndDisplayResults() {
            const scores = calculateScores();
            const prenom = document.getElementById('prenom').value;

            let scoresHTML = '';
            Object.keys(questionnaire).forEach(maskKey => {
                const mask = questionnaire[maskKey];
                const score = scores[maskKey];
                const level = getScoreLevel(score);
                const percentage = (score / 64) * 100;

                scoresHTML += `
                    <div class="score-card ${maskKey}">
                        <h3>${mask.name}</h3>
                        <div class="score-value">${score}</div>
                        <div class="score-level">${level.level}</div>
                        <p style="font-size: 0.9em; color: #666; margin: 10px 0;">Peur: ${mask.fear}</p>
                        <div class="score-bar">
                            <div class="score-bar-fill" style="width: ${percentage}%; background: ${level.color};"></div>
                        </div>
                    </div>
                `;
            });
            document.getElementById('scores-container').innerHTML = scoresHTML;

            const dominant = Object.keys(scores).reduce((a, b) => scores[a] > scores[b] ? a : b);
            const globalScore = Object.values(scores).reduce((a, b) => a + b, 0);

            let portraitHTML = `
                <p class="portrait-text">
                    <strong>√âvaluation g√©n√©rale (score total: ${globalScore}/448):</strong><br>
                    Vous avez un profil avec activation ${getScoreLevel(globalScore / 7).level.toLowerCase()} des m√©canismes de d√©fense.
                </p>
                <p class="portrait-text">
                    <strong>Masque pr√©dominant: ${questionnaire[dominant].name}</strong><br>
                    ${getMaskInterpretation(dominant, scores[dominant])}
                </p>
                <p class="portrait-text">
                    Votre dynamique psychologique r√©v√®le une interaction complexe entre plusieurs strat√©gies de protection.
                    Le travail th√©rapeutique devrait d'abord se concentrer sur le masque dominant, puis explorer les interactions avec les masques secondaires.
                </p>
            `;
            document.getElementById('portrait-global').innerHTML = portraitHTML;

            let criticalHTML = '<div class="critical-items"><h4>Items √† score maximal (4 - Tr√®s souvent)</h4><ul>';
            let criticalCount = 0;
            Object.keys(questionnaire).forEach(maskKey => {
                questionnaire[maskKey].items.forEach(item => {
                    if (responses[item.id]) {
                        let finalValue = responses[item.id].value;
                        if (responses[item.id].inverted) {
                            finalValue = 4 - finalValue;
                        }
                        if (finalValue === 4) {
                            criticalHTML += `<li><strong>${item.id}</strong> - ${item.text}</li>`;
                            criticalCount++;
                        }
                    }
                });
            });
            if (criticalCount === 0) {
                criticalHTML += '<li>Aucun item √† score maximal - c\'est une excellente ressource!</li>';
            }
            criticalHTML += '</ul></div>';

            let resourcesHTML = '<div class="resources-items"><h4>Items √† score nul (0 - Jamais)</h4><ul>';
            let resourceCount = 0;
            Object.keys(questionnaire).forEach(maskKey => {
                questionnaire[maskKey].items.forEach(item => {
                    if (responses[item.id]) {
                        let finalValue = responses[item.id].value;
                        if (responses[item.id].inverted) {
                            finalValue = 4 - finalValue;
                        }
                        if (finalValue === 0) {
                            resourcesHTML += `<li><strong>${item.id}</strong> - ${item.text}</li>`;
                            resourceCount++;
                        }
                    }
                });
            });

            if (resourceCount === 0) {
                resourcesHTML += '<li>Peu de ressources identifi√©es - cela peut indiquer une activation globale des m√©canismes d√©fensifs</li>';
            }
            resourcesHTML += '</ul></div>';

            document.getElementById('critical-analysis').innerHTML = criticalHTML;
            document.getElementById('resources-analysis').innerHTML = resourcesHTML;

            const approaches = {
                red: "TCC anxi√©t√© li√©e √† la sant√© ‚Ä¢ Restructuration cognitive ‚Ä¢ Exposition int√©roceptive ‚Ä¢ Mindfulness ‚Ä¢ ACT",
                orange: "ACT ‚Ä¢ Th√©rapie centr√©e sur √©motions (EFT) ‚Ä¢ Travail alexithymie ‚Ä¢ EMDR si trauma ‚Ä¢ DBT skills",
                yellow: "TCC TAG ‚Ä¢ ERP ‚Ä¢ Flexibilit√© cognitive ‚Ä¢ Mindfulness ‚Ä¢ Exposition √† l'incertitude",
                green: "Th√©rapie des sch√©mas ‚Ä¢ Th√©rapie attachement ‚Ä¢ Affirmation de soi ‚Ä¢ Travail limites ‚Ä¢ TCC anxi√©t√© sociale",
                blue: "Th√©rapie des sch√©mas ‚Ä¢ R√©gulation col√®re (Novaco) ‚Ä¢ Empathie ‚Ä¢ ACT ‚Ä¢ Th√©rapie relationnelle",
                indigo: "TCC perfectionnisme ‚Ä¢ Syndrome imposteur ‚Ä¢ Th√©rapie sch√©mas ‚Ä¢ Auto-compassion ‚Ä¢ Exposition imperfection",
                violet: "Psychoth√©rapie existentielle ‚Ä¢ Th√©rapie des sch√©mas ‚Ä¢ Exploration identitaire ‚Ä¢ Th√©rapie narrative ‚Ä¢ Travail vrai/faux self"
            };

            let planHTML = '';
            const sortedMasks = Object.keys(scores).sort((a, b) => scores[b] - scores[a]).slice(0, 3);

            sortedMasks.forEach((maskKey, index) => {
                planHTML += `
                    <div class="phase">
                        <div class="phase-title">Masque ${questionnaire[maskKey].name} (Priorit√© ${index + 1})</div>
                        <div class="phase-content">
                            Score: ${scores[maskKey]}/64 | Approches: ${approaches[maskKey]}<br>
                            Dur√©e estim√©e: ${scores[maskKey] > 48 ? "24-40 s√©ances" : scores[maskKey] > 32 ? "15-24 s√©ances" : "12-16 s√©ances"}
                        </div>
                    </div>
                `;
            });

            planHTML += `
                <div class="phase" style="background: #f0f9ff; margin-top: 20px;">
                    <div class="phase-title">S√©quen√ßage recommand√©</div>
                    <div class="phase-content">
                        <strong>Phase 1 (S√©ances 1-4):</strong> Psycho√©ducation, alliance, restitution<br>
                        <strong>Phase 2 (S√©ances 5-12):</strong> Travail cibl√© sur masques dominants<br>
                        <strong>Phase 3 (S√©ances 13+):</strong> Consolidation et suivi
                    </div>
                </div>
            `;
            document.getElementById('therapeutic-plan').innerHTML = planHTML;

            // NOUVELLE SECTION : CARTE D√âTAILL√âE DES MASQUES
            let detailHTML = '';

            Object.keys(questionnaire).forEach(maskKey => {
                const mask = questionnaire[maskKey];
                const score = scores[maskKey];
                const level = getScoreLevel(score);

                // Identifier les items critiques (3-4) et ressources (0-1)
                let criticalItems = [];
                let resourceItems = [];

                mask.items.forEach(item => {
                    if (responses[item.id]) {
                        let finalValue = responses[item.id].value;
                        if (responses[item.id].inverted) {
                            finalValue = 4 - finalValue;
                        }

                        if (finalValue >= 3) {
                            criticalItems.push({id: item.id, text: item.text, value: finalValue});
                        }
                        if (finalValue <= 1) {
                            resourceItems.push({id: item.id, text: item.text, value: finalValue});
                        }
                    }
                });

                // Analyse contextuelle bas√©e sur les items critiques
                let contextsHTML = analyzeContexts(maskKey, criticalItems);
                let impactHTML = analyzeImpact(maskKey, criticalItems);
                let mechanismsHTML = analyzeMechanisms(maskKey, criticalItems);

                detailHTML += `
                    <div style="margin-bottom: 40px; padding: 30px; background: white; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); border-left: 6px solid ${level.color};">

                        <!-- En-t√™te du masque -->
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                            <div>
                                <h3 style="color: ${level.color}; font-size: 1.8em; margin-bottom: 5px;">${mask.name}</h3>
                                <p style="color: #666; font-size: 0.95em;">Peur primale : ${mask.fear}</p>
                            </div>
                            <div style="text-align: right;">
                                <div style="font-size: 3em; font-weight: bold; color: ${level.color};">${score}/64</div>
                                <div style="font-size: 1.2em; font-weight: 600; color: ${level.color};">${level.level}</div>
                            </div>
                        </div>

                        <!-- Niveau d'emprise -->
                        <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                            <h4 style="color: #333; margin-bottom: 10px;">üìä Niveau d'emprise</h4>
                            <p style="color: #666; line-height: 1.6;">${getMaskInterpretation(maskKey, score)}</p>
                            <div style="margin-top: 10px;">
                                <strong>Intensit√© :</strong> ${criticalItems.length} item(s) √† activation √©lev√©e (3-4) sur ${mask.items.length}
                            </div>
                        </div>

                        <!-- Contextes d'activation -->
                        ${criticalItems.length > 0 ? `
                        <div style="background: #fff3cd; padding: 20px; border-radius: 8px; margin-bottom: 20px; border-left: 4px solid #ffc107;">
                            <h4 style="color: #856404; margin-bottom: 15px;">‚ö†Ô∏è Contextes d'activation majeure</h4>
                            ${contextsHTML}
                        </div>
                        ` : ''}

                        <!-- R√©ponses critiques d√©taill√©es -->
                        ${criticalItems.length > 0 ? `
                        <div style="background: #f8d7da; padding: 20px; border-radius: 8px; margin-bottom: 20px; border-left: 4px solid #dc3545;">
                            <h4 style="color: #721c24; margin-bottom: 15px;">üö® Manifestations concr√®tes (Items critiques)</h4>
                            <ul style="margin: 0; padding-left: 20px;">
                                ${criticalItems.map(item => `
                                    <li style="margin-bottom: 12px; color: #721c24;">
                                        <strong>${item.id}</strong> (score: ${item.value}/4) : ${item.text}
                                    </li>
                                `).join('')}
                            </ul>
                        </div>
                        ` : ''}

                        <!-- M√©canismes d√©fensifs -->
                        ${mechanismsHTML}

                        <!-- Impact sur la vie -->
                        ${impactHTML}

                        <!-- Ressources disponibles -->
                        ${resourceItems.length > 0 ? `
                        <div style="background: #d4edda; padding: 20px; border-radius: 8px; margin-bottom: 20px; border-left: 4px solid #28a745;">
                            <h4 style="color: #155724; margin-bottom: 15px;">üí™ Ressources √† mobiliser</h4>
                            <ul style="margin: 0; padding-left: 20px;">
                                ${resourceItems.map(item => `
                                    <li style="margin-bottom: 10px; color: #155724;">
                                        <strong>${item.id}</strong> : ${item.text}
                                    </li>
                                `).join('')}
                            </ul>
                            <p style="margin-top: 15px; color: #155724; font-style: italic;">
                                Ces capacit√©s pr√©serv√©es constituent des leviers th√©rapeutiques pr√©cieux pour transcender ce masque.
                            </p>
                        </div>
                        ` : `
                        <div style="background: #fff3cd; padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                            <p style="color: #856404; margin: 0;">
                                ‚ö†Ô∏è Peu de ressources identifi√©es sur ce masque - cela sugg√®re une activation g√©n√©ralis√©e n√©cessitant un travail th√©rapeutique approfondi.
                            </p>
                        </div>
                        `}

                    </div>
                `;
            });

            document.getElementById('detailed-interpretations').innerHTML = detailHTML;

            // FONCTIONS D'ANALYSE CONTEXTUELLE

            function analyzeContexts(maskKey, criticalItems) {
                if (criticalItems.length === 0) return '';

                const contexts = {
                    red: {
                        high: "Le masque s'active particuli√®rement lors de sensations corporelles inhabituelles, consultations m√©dicales, ou exposition √† des informations sur la sant√©. L'hypervigilance somatique est constante.",
                        moderate: "Le masque se manifeste surtout en pr√©sence de sympt√¥mes physiques ou dans des situations de stress o√π le corps est sollicit√©."
                    },
                    orange: {
                        high: "Le masque domine dans les situations d'intimit√© √©motionnelle, lors d'expressions affectives d'autrui, ou face √† ses propres ressentis. La dissociation affective est quasi-permanente.",
                        moderate: "Le masque se manifeste principalement dans les contextes relationnels charg√©s √©motionnellement ou lors de confrontation √† ses propres √©motions."
                    },
                    yellow: {
                        high: "Le masque s'active face √† toute forme d'impr√©vu, d'incertitude ou de changement. Le besoin de contr√¥le et de pr√©visibilit√© envahit tous les domaines de vie.",
                        moderate: "Le masque se manifeste surtout lors de situations nouvelles, de prises de d√©cision, ou face √† des √©v√©nements non planifi√©s."
                    },
                    green: {
                        high: "Le masque domine dans toutes les interactions sociales, particuli√®rement lors de d√©saccords, de solitude, ou face au risque de rejet. L'adaptation √† autrui est syst√©matique.",
                        moderate: "Le masque se manifeste surtout dans les relations significatives, lors d'affirmation de soi, ou en situation de conflit potentiel."
                    },
                    blue: {
                        high: "Le masque s'active d√®s qu'autrui exerce un contr√¥le, lors de d√©l√©gation, ou face √† l'impr√©vu. Le besoin de ma√Ætrise et de domination est omnipr√©sent.",
                        moderate: "Le masque se manifeste principalement dans les situations o√π le contr√¥le est partag√© ou contest√©, et lors de d√©pendance √† autrui."
                    },
                    indigo: {
                        high: "Le masque domine dans toute situation d'√©valuation, de performance, ou de visibilit√© sociale. Le perfectionnisme et le doute paralysent l'action.",
                        moderate: "Le masque se manifeste surtout lors de nouveaux d√©fis, de projets importants, ou face au regard d'autrui sur ses comp√©tences."
                    },
                    violet: {
                        high: "Le masque envahit tous les domaines : confusion identitaire profonde, vie en mode automatique, perte de sens existentiel. L'ali√©nation est majeure.",
                        moderate: "Le masque se manifeste lors de moments de solitude, de questionnements identitaires, ou face √† des choix de vie importants."
                    }
                };

                const level = criticalItems.length >= 5 ? 'high' : 'moderate';
                return `<p style="color: #856404; line-height: 1.6; margin: 0;">${contexts[maskKey][level]}</p>`;
            }

            function analyzeMechanisms(maskKey, criticalItems) {
                if (criticalItems.length === 0) return '';

                const mechanisms = {
                    red: "Hypervigilance corporelle ‚Ä¢ √âvitement d'activit√©s physiques ‚Ä¢ Recherche compulsive de r√©assurance m√©dicale ‚Ä¢ Catastrophisme sanitaire",
                    orange: "Intellectualisation ‚Ä¢ Distraction compulsive ‚Ä¢ Minimisation √©motionnelle ‚Ä¢ D√©connexion psychocorporelle ‚Ä¢ Fuite relationnelle",
                    yellow: "Planification excessive ‚Ä¢ V√©rifications compulsives ‚Ä¢ Rigidification des routines ‚Ä¢ Anticipation anxieuse ‚Ä¢ Besoin d'information exhaustive",
                    green: "Sur-adaptation relationnelle ‚Ä¢ Effacement de soi ‚Ä¢ Recherche de r√©assurance affective ‚Ä¢ Hypervigilance au rejet ‚Ä¢ Sacrifice de ses besoins",
                    blue: "Hypercontr√¥le ‚Ä¢ Refus de d√©l√©gation ‚Ä¢ Irritabilit√© face √† l'impr√©vu ‚Ä¢ Domination relationnelle ‚Ä¢ Intol√©rance √† la d√©pendance",
                    indigo: "Procrastination paralysante ‚Ä¢ Auto-sabotage ‚Ä¢ √âvitement de d√©fis ‚Ä¢ Surinvestissement perfectionniste ‚Ä¢ Comparaison sociale constante",
                    violet: "Conformisme social excessif ‚Ä¢ R√©pression identitaire ‚Ä¢ Fonctionnement automatique ‚Ä¢ √âvitement introspectif ‚Ä¢ Rigidification du self"
                };

                return `
                    <div style="background: #e7f3ff; padding: 20px; border-radius: 8px; margin-bottom: 20px; border-left: 4px solid #007bff;">
                        <h4 style="color: #004085; margin-bottom: 10px;">üîÑ M√©canismes d√©fensifs actifs</h4>
                        <p style="color: #004085; margin: 0; line-height: 1.6;">${mechanisms[maskKey]}</p>
                    </div>
                `;
            }

            function analyzeImpact(maskKey, criticalItems) {
                if (criticalItems.length === 0) return '';

                const impacts = {
                    red: {
                        relationnel: "D√©pendance aux proches pour r√©assurance ‚Ä¢ √âvitement d'activit√©s sociales par peur ‚Ä¢ Isolement progressif",
                        professionnel: "Absent√©isme li√© √† la sant√© ‚Ä¢ Difficult√©s de concentration ‚Ä¢ Consultations m√©dicales fr√©quentes",
                        quotidien: "Restriction des activit√©s physiques ‚Ä¢ Surinvestissement dans la surveillance corporelle ‚Ä¢ Sommeil perturb√©"
                    },
                    orange: {
                        relationnel: "Froideur √©motionnelle per√ßue ‚Ä¢ Difficult√©s d'intimit√© ‚Ä¢ Incompr√©hension mutuelle ‚Ä¢ Relations superficielles",
                        professionnel: "Communication factuelle uniquement ‚Ä¢ √âvitement des feedbacks √©motionnels ‚Ä¢ Leadership distant",
                        quotidien: "Surinvestissement dans l'action ‚Ä¢ Anesth√©sie par le travail/substances ‚Ä¢ Vide int√©rieur"
                    },
                    yellow: {
                        relationnel: "Rigidit√© dans les interactions ‚Ä¢ Difficult√© avec la spontan√©it√© ‚Ä¢ Contr√¥le des activit√©s communes",
                        professionnel: "Lenteur d√©cisionnelle ‚Ä¢ Inflexibilit√© ‚Ä¢ Stress face aux changements organisationnels",
                        quotidien: "Surcharge mentale par anticipation ‚Ä¢ √âpuisement cognitif ‚Ä¢ Vie routini√®re sans plaisir"
                    },
                    green: {
                        relationnel: "D√©s√©quilibre donneur/receveur ‚Ä¢ Relations asym√©triques ‚Ä¢ Difficult√© √† poser limites ‚Ä¢ D√©pendance affective",
                        professionnel: "Difficult√© √† refuser ‚Ä¢ Surcharge de travail ‚Ä¢ √âvitement des conflits ‚Ä¢ Manque d'assertivit√©",
                        quotidien: "Sacrifice de ses besoins ‚Ä¢ Anxi√©t√© relationnelle constante ‚Ä¢ Solitude v√©cue comme menace"
                    },
                    blue: {
                        relationnel: "Conflits fr√©quents ‚Ä¢ Difficult√© de collaboration ‚Ä¢ Relations tendues ‚Ä¢ Autoritarisme per√ßu",
                        professionnel: "Micromanagement ‚Ä¢ √âpuisement de l'√©quipe ‚Ä¢ Difficult√© √† d√©l√©guer ‚Ä¢ Conflits hi√©rarchiques",
                        quotidien: "Irritabilit√© chronique ‚Ä¢ Fatigue li√©e au contr√¥le ‚Ä¢ Relations familiales tendues"
                    },
                    indigo: {
                        relationnel: "Comparaison sociale constante ‚Ä¢ √âvitement de visibilit√© ‚Ä¢ Syndrome de l'imposteur relationnel",
                        professionnel: "Procrastination paralysante ‚Ä¢ Sous-r√©alisation ‚Ä¢ Refus d'opportunit√©s ‚Ä¢ Surinvestissement improductif",
                        quotidien: "Autocritique s√©v√®re ‚Ä¢ Insatisfaction chronique ‚Ä¢ √âvitement de nouveaut√©s"
                    },
                    violet: {
                        relationnel: "Sentiment de fausset√© ‚Ä¢ Distance avec soi ‚Ä¢ Relations bas√©es sur des r√¥les ‚Ä¢ Inauthenticit√©",
                        professionnel: "Fonctionnement m√©canique ‚Ä¢ Perte de sens ‚Ä¢ D√©motivation profonde ‚Ä¢ Questionnement existentiel",
                        quotidien: "Vie en mode automatique ‚Ä¢ Absence de plaisir ‚Ä¢ Nostalgie du 'vrai soi' ‚Ä¢ Crise existentielle"
                    }
                };

                const impact = impacts[maskKey];
                return `
                    <div style="background: #f3e5f5; padding: 20px; border-radius: 8px; margin-bottom: 20px; border-left: 4px solid #9c27b0;">
                        <h4 style="color: #4a148c; margin-bottom: 15px;">üí• Impact sur la vie quotidienne</h4>
                        <div style="margin-bottom: 12px;">
                            <strong style="color: #4a148c;">Sur le plan relationnel :</strong>
                            <p style="color: #6a1b9a; margin: 5px 0 0 0;">${impact.relationnel}</p>
                        </div>
                        <div style="margin-bottom: 12px;">
                            <strong style="color: #4a148c;">Sur le plan professionnel :</strong>
                            <p style="color: #6a1b9a; margin: 5px 0 0 0;">${impact.professionnel}</p>
                        </div>
                        <div>
                            <strong style="color: #4a148c;">Dans le quotidien :</strong>
                            <p style="color: #6a1b9a; margin: 5px 0 0 0;">${impact.quotidien}</p>
                        </div>
                    </div>
                `;
            }


            document.getElementById('result-date').textContent = new Date().toLocaleDateString('fr-FR', { year: 'numeric', month: 'long', day: 'numeric' });

            showSection('results');
            window.scrollTo(0, 0);
        }

        function exportJSON() {
            const data = {
                prenom: document.getElementById('prenom').value,
                age: document.getElementById('age').value,
                genre: document.getElementById('genre').value,
                situation: document.getElementById('situation').value,
                attachement: document.getElementById('attachement').value,
                date: new Date().toISOString(),
                responses: responses,
                scores: calculateScores()
            };
            const json = JSON.stringify(data, null, 2);
            const blob = new Blob([json], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `masques-resultats-${new Date().getTime()}.json`;
            a.click();
            URL.revokeObjectURL(url);
        }

        function resetQuestionnaire() {
            if (confirm('√ätes-vous s√ªr de vouloir recommencer ? Toutes vos r√©ponses seront effac√©es.')) {
                responses = {};
                document.querySelectorAll('input[type="radio"]').forEach(input => input.checked = false);
                document.querySelector('.progress-fill').style.width = '0%';
                document.getElementById('prenom').value = '';
                document.getElementById('age').value = '';
                document.getElementById('genre').value = '';
                document.getElementById('situation').value = '';
                document.getElementById('attachement').value = '';
                showSection('welcome');
                window.scrollTo(0, 0);
            }
        }
        function analyzeContexts(maskKey, criticalItems) {
            if (criticalItems.length === 0) return '';

            const contexts = {
                red: {
                    high: "Le masque s'active particuli√®rement lors de sensations corporelles inhabituelles, consultations m√©dicales, ou exposition √† des informations sur la sant√©. L'hypervigilance somatique est constante.",
                    moderate: "Le masque se manifeste surtout en pr√©sence de sympt√¥mes physiques ou dans des situations de stress o√π le corps est sollicit√©."
                },
                orange: {
                    high: "Le masque domine dans les situations d'intimit√© √©motionnelle, lors d'expressions affectives d'autrui, ou face √† ses propres ressentis. La dissociation affective est quasi-permanente.",
                    moderate: "Le masque se manifeste principalement dans les contextes relationnels charg√©s √©motionnellement ou lors de confrontation √† ses propres √©motions."
                },
                yellow: {
                    high: "Le masque s'active face √† toute forme d'impr√©vu, d'incertitude ou de changement. Le besoin de contr√¥le et de pr√©visibilit√© envahit tous les domaines de vie.",
                    moderate: "Le masque se manifeste surtout lors de situations nouvelles, de prises de d√©cision, ou face √† des √©v√©nements non planifi√©s."
                },
                green: {
                    high: "Le masque domine dans toutes les interactions sociales, particuli√®rement lors de d√©saccords, de solitude, ou face au risque de rejet. L'adaptation √† autrui est syst√©matique.",
                    moderate: "Le masque se manifeste surtout dans les relations significatives, lors d'affirmation de soi, ou en situation de conflit potentiel."
                },
                blue: {
                    high: "Le masque s'active d√®s qu'autrui exerce un contr√¥le, lors de d√©l√©gation, ou face √† l'impr√©vu. Le besoin de ma√Ætrise et de domination est omnipr√©sent.",
                    moderate: "Le masque se manifeste principalement dans les situations o√π le contr√¥le est partag√© ou contest√©, et lors de d√©pendance √† autrui."
                },
                indigo: {
                    high: "Le masque domine dans toute situation d'√©valuation, de performance, ou de visibilit√© sociale. Le perfectionnisme et le doute paralysent l'action.",
                    moderate: "Le masque se manifeste surtout lors de nouveaux d√©fis, de projets importants, ou face au regard d'autrui sur ses comp√©tences."
                },
                violet: {
                    high: "Le masque envahit tous les domaines : confusion identitaire profonde, vie en mode automatique, perte de sens existentiel. L'ali√©nation est majeure.",
                    moderate: "Le masque se manifeste lors de moments de solitude, de questionnements identitaires, ou face √† des choix de vie importants."
                }
            };

            const level = criticalItems.length >= 5 ? 'high' : 'moderate';
            return `<p style="color: #856404; line-height: 1.6; margin: 0;">${contexts[maskKey][level]}</p>`;
        }

        function analyzeMechanisms(maskKey, criticalItems) {
            if (criticalItems.length === 0) return '';

            const mechanisms = {
                red: "Hypervigilance corporelle ‚Ä¢ √âvitement d'activit√©s physiques ‚Ä¢ Recherche compulsive de r√©assurance m√©dicale ‚Ä¢ Catastrophisme sanitaire",
                orange: "Intellectualisation ‚Ä¢ Distraction compulsive ‚Ä¢ Minimisation √©motionnelle ‚Ä¢ D√©connexion psychocorporelle ‚Ä¢ Fuite relationnelle",
                yellow: "Planification excessive ‚Ä¢ V√©rifications compulsives ‚Ä¢ Rigidification des routines ‚Ä¢ Anticipation anxieuse ‚Ä¢ Besoin d'information exhaustive",
                green: "Sur-adaptation relationnelle ‚Ä¢ Effacement de soi ‚Ä¢ Recherche de r√©assurance affective ‚Ä¢ Hypervigilance au rejet ‚Ä¢ Sacrifice de ses besoins",
                blue: "Hypercontr√¥le ‚Ä¢ Refus de d√©l√©gation ‚Ä¢ Irritabilit√© face √† l'impr√©vu ‚Ä¢ Domination relationnelle ‚Ä¢ Intol√©rance √† la d√©pendance",
                indigo: "Procrastination paralysante ‚Ä¢ Auto-sabotage ‚Ä¢ √âvitement de d√©fis ‚Ä¢ Surinvestissement perfectionniste ‚Ä¢ Comparaison sociale constante",
                violet: "Conformisme social excessif ‚Ä¢ R√©pression identitaire ‚Ä¢ Fonctionnement automatique ‚Ä¢ √âvitement introspectif ‚Ä¢ Rigidification du self"
            };

            return `
                <div style="background: #e7f3ff; padding: 20px; border-radius: 8px; margin-bottom: 20px; border-left: 4px solid #007bff;">
                    <h4 style="color: #004085; margin-bottom: 10px;">üîÑ M√©canismes d√©fensifs actifs</h4>
                    <p style="color: #004085; margin: 0; line-height: 1.6;">${mechanisms[maskKey]}</p>
                </div>
            `;
        }

        function analyzeImpact(maskKey, criticalItems) {
            if (criticalItems.length === 0) return '';

            const impacts = {
                red: {
                    relationnel: "D√©pendance aux proches pour r√©assurance ‚Ä¢ √âvitement d'activit√©s sociales par peur ‚Ä¢ Isolement progressif",
                    professionnel: "Absent√©isme li√© √† la sant√© ‚Ä¢ Difficult√©s de concentration ‚Ä¢ Consultations m√©dicales fr√©quentes",
                    quotidien: "Restriction des activit√©s physiques ‚Ä¢ Surinvestissement dans la surveillance corporelle ‚Ä¢ Sommeil perturb√©"
                },
                orange: {
                    relationnel: "Froideur √©motionnelle per√ßue ‚Ä¢ Difficult√©s d'intimit√© ‚Ä¢ Incompr√©hension mutuelle ‚Ä¢ Relations superficielles",
                    professionnel: "Communication factuelle uniquement ‚Ä¢ √âvitement des feedbacks √©motionnels ‚Ä¢ Leadership distant",
                    quotidien: "Surinvestissement dans l'action ‚Ä¢ Anesth√©sie par le travail/substances ‚Ä¢ Vide int√©rieur"
                },
                yellow: {
                    relationnel: "Rigidit√© dans les interactions ‚Ä¢ Difficult√© avec la spontan√©it√© ‚Ä¢ Contr√¥le des activit√©s communes",
                    professionnel: "Lenteur d√©cisionnelle ‚Ä¢ Inflexibilit√© ‚Ä¢ Stress face aux changements organisationnels",
                    quotidien: "Surcharge mentale par anticipation ‚Ä¢ √âpuisement cognitif ‚Ä¢ Vie routini√®re sans plaisir"
                },
                green: {
                    relationnel: "D√©s√©quilibre donneur/receveur ‚Ä¢ Relations asym√©triques ‚Ä¢ Difficult√© √† poser limites ‚Ä¢ D√©pendance affective",
                    professionnel: "Difficult√© √† refuser ‚Ä¢ Surcharge de travail ‚Ä¢ √âvitement des conflits ‚Ä¢ Manque d'assertivit√©",
                    quotidien: "Sacrifice de ses besoins ‚Ä¢ Anxi√©t√© relationnelle constante ‚Ä¢ Solitude v√©cue comme menace"
                },
                blue: {
                    relationnel: "Conflits fr√©quents ‚Ä¢ Difficult√© de collaboration ‚Ä¢ Relations tendues ‚Ä¢ Autoritarisme per√ßu",
                    professionnel: "Micromanagement ‚Ä¢ √âpuisement de l'√©quipe ‚Ä¢ Difficult√© √† d√©l√©guer ‚Ä¢ Conflits hi√©rarchiques",
                    quotidien: "Irritabilit√© chronique ‚Ä¢ Fatigue li√©e au contr√¥le ‚Ä¢ Relations familiales tendues"
                },
                indigo: {
                    relationnel: "Comparaison sociale constante ‚Ä¢ √âvitement de visibilit√© ‚Ä¢ Syndrome de l'imposteur relationnel",
                    professionnel: "Procrastination paralysante ‚Ä¢ Sous-r√©alisation ‚Ä¢ Refus d'opportunit√©s ‚Ä¢ Surinvestissement improductif",
                    quotidien: "Autocritique s√©v√®re ‚Ä¢ Insatisfaction chronique ‚Ä¢ √âvitement de nouveaut√©s"
                },
                violet: {
                    relationnel: "Sentiment de fausset√© ‚Ä¢ Distance avec soi ‚Ä¢ Relations bas√©es sur des r√¥les ‚Ä¢ Inauthenticit√©",
                    professionnel: "Fonctionnement m√©canique ‚Ä¢ Perte de sens ‚Ä¢ D√©motivation profonde ‚Ä¢ Questionnement existentiel",
                    quotidien: "Vie en mode automatique ‚Ä¢ Absence de plaisir ‚Ä¢ Nostalgie du 'vrai soi' ‚Ä¢ Crise existentielle"
                }
            };

            const impact = impacts[maskKey];
            return `
                <div style="background: #f3e5f5; padding: 20px; border-radius: 8px; margin-bottom: 20px; border-left: 4px solid #9c27b0;">
                    <h4 style="color: #4a148c; margin-bottom: 15px;">üí• Impact sur la vie quotidienne</h4>
                    <div style="margin-bottom: 12px;">
                        <strong style="color: #4a148c;">Sur le plan relationnel :</strong>
                        <p style="color: #6a1b9a; margin: 5px 0 0 0;">${impact.relationnel}</p>
                    </div>
                    <div style="margin-bottom: 12px;">
                        <strong style="color: #4a148c;">Sur le plan professionnel :</strong>
                        <p style="color: #6a1b9a; margin: 5px 0 0 0;">${impact.professionnel}</p>
                    </div>
                    <div>
                        <strong style="color: #4a148c;">Dans le quotidien :</strong>
                        <p style="color: #6a1b9a; margin: 5px 0 0 0;">${impact.quotidien}</p>
                    </div>
                </div>
            `;
        }
        function exportPDF() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF('p', 'mm', 'a4');

            const prenom = document.getElementById('prenom').value;
            const age = document.getElementById('age').value;
            const genre = document.getElementById('genre').value;
            const situation = document.getElementById('situation').value;
            const attachement = document.getElementById('attachement').value;
            const scores = calculateScores();
            const date = new Date().toLocaleDateString('fr-FR', { year: 'numeric', month: 'long', day: 'numeric' });

            let yPos = 20;
            const pageHeight = 297;
            const margin = 20;
            const lineHeight = 7;

            // Fonction pour ajouter une nouvelle page si n√©cessaire
            function checkPageBreak(neededSpace = 10) {
                if (yPos + neededSpace > pageHeight - margin) {
                    doc.addPage();
                    yPos = margin;
                }
            }

            // En-t√™te
            doc.setFontSize(18);
            doc.setFont(undefined, 'bold');
            doc.text('QUESTIONNAIRE V.A.L.E.U.R¬©', 105, yPos, { align: 'center' });
            yPos += 10;

            doc.setFontSize(10);
            doc.setFont(undefined, 'normal');
            doc.text('Rapport d\'analyse des masques psychologiques', 105, yPos, { align: 'center' });
            yPos += 5;
            doc.text(date, 105, yPos, { align: 'center' });
            yPos += 15;

            // Informations patient
            doc.setFontSize(12);
            doc.setFont(undefined, 'bold');
            doc.text('INFORMATIONS PATIENT', margin, yPos);
            yPos += 8;

            doc.setFontSize(10);
            doc.setFont(undefined, 'normal');
            doc.text('Pr√©nom/Initiales : ' + prenom, margin, yPos);
            yPos += 6;
            doc.text('√Çge : ' + age, margin, yPos);
            yPos += 6;
            doc.text('Genre : ' + genre, margin, yPos);
            yPos += 6;
            doc.text('Situation professionnelle : ' + situation, margin, yPos);
            yPos += 6;
            doc.text('Style d\'attachement : ' + attachement, margin, yPos);
            yPos += 12;

            // Scores globaux
            checkPageBreak(60);
            doc.setFontSize(12);
            doc.setFont(undefined, 'bold');
            doc.text('SCORES PAR MASQUE', margin, yPos);
            yPos += 8;

            doc.setFontSize(10);
            doc.setFont(undefined, 'normal');

            const globalScore = Object.values(scores).reduce((a, b) => a + b, 0);
            doc.text('Score global : ' + globalScore + '/448', margin, yPos);
            yPos += 8;

            Object.keys(questionnaire).forEach(maskKey => {
                const mask = questionnaire[maskKey];
                const score = scores[maskKey];
                const level = getScoreLevel(score);

                checkPageBreak(8);
                doc.setFont(undefined, 'bold');
                doc.text(mask.name + ' : ' + score + '/64', margin, yPos);
                doc.setFont(undefined, 'normal');
                doc.text('(' + level.level + ')', margin + 70, yPos);
                yPos += 6;
            });

            yPos += 10;

            // Masque dominant
            checkPageBreak(20);
            const dominant = Object.keys(scores).reduce((a, b) => scores[a] > scores[b] ? a : b);
            doc.setFontSize(12);
            doc.setFont(undefined, 'bold');
            doc.text('MASQUE DOMINANT', margin, yPos);
            yPos += 8;

            doc.setFontSize(10);
            doc.setFont(undefined, 'normal');
            doc.text(questionnaire[dominant].name, margin, yPos);
            yPos += 6;
            doc.text('Peur primale : ' + questionnaire[dominant].fear, margin, yPos);
            yPos += 12;

            // Items critiques
            checkPageBreak(30);
            doc.setFontSize(12);
            doc.setFont(undefined, 'bold');
            doc.text('ITEMS CRITIQUES (Score 4 - Tr√®s souvent)', margin, yPos);
            yPos += 8;

            doc.setFontSize(9);
            doc.setFont(undefined, 'normal');

            let criticalCount = 0;
            Object.keys(questionnaire).forEach(maskKey => {
                questionnaire[maskKey].items.forEach(item => {
                    if (responses[item.id]) {
                        let finalValue = responses[item.id].value;
                        if (responses[item.id].inverted) {
                            finalValue = 4 - finalValue;
                        }
                        if (finalValue === 4) {
                            checkPageBreak(12);
                            doc.setFont(undefined, 'bold');
                            doc.text(item.id, margin, yPos);
                            doc.setFont(undefined, 'normal');

                            const textLines = doc.splitTextToSize(item.text, 160);
                            doc.text(textLines, margin + 15, yPos);
                            yPos += textLines.length * 5 + 3;
                            criticalCount++;
                        }
                    }
                });
            });

            if (criticalCount === 0) {
                doc.text('Aucun item √† score maximal identifi√©', margin, yPos);
                yPos += 8;
            }

            yPos += 10;

            // Ressources
            checkPageBreak(30);
            doc.setFontSize(12);
            doc.setFont(undefined, 'bold');
            doc.text('RESSOURCES IDENTIFIEES (Score 0 - Jamais)', margin, yPos);
            yPos += 8;

            doc.setFontSize(9);
            doc.setFont(undefined, 'normal');

            let resourceCount = 0;
            Object.keys(questionnaire).forEach(maskKey => {
                questionnaire[maskKey].items.forEach(item => {
                    if (responses[item.id]) {
                        let finalValue = responses[item.id].value;
                        if (responses[item.id].inverted) {
                            finalValue = 4 - finalValue;
                        }
                        if (finalValue === 0) {
                            checkPageBreak(12);
                            doc.setFont(undefined, 'bold');
                            doc.text(item.id, margin, yPos);
                            doc.setFont(undefined, 'normal');

                            const textLines = doc.splitTextToSize(item.text, 160);
                            doc.text(textLines, margin + 15, yPos);
                            yPos += textLines.length * 5 + 3;
                            resourceCount++;
                        }
                    }
                });
            });

            if (resourceCount === 0) {
                doc.text('Peu de ressources identifi√©es', margin, yPos);
                yPos += 8;
            }

            // Pied de page sur toutes les pages
            const pageCount = doc.internal.getNumberOfPages();
            for (let i = 1; i <= pageCount; i++) {
                doc.setPage(i);
                doc.setFontSize(8);
                doc.setFont(undefined, 'italic');
                doc.text('Questionnaire V.A.L.E.U.R¬© - Page ' + i + '/' + pageCount, 105, 285, { align: 'center' });
                doc.text('Document confidentiel - Usage th√©rapeutique uniquement', 105, 290, { align: 'center' });
            }

            // T√©l√©charger le PDF
            doc.save('Questionnaire-VALEUR-' + prenom + '-' + new Date().getTime() + '.pdf');
        }

        document.addEventListener('DOMContentLoaded', initializeQuestionnaire);

        document.addEventListener('DOMContentLoaded', initializeQuestionnaire);
            </script>
        </body>
	(function() {
  // 1. M√©tadonn√©es des masques (ordre, couleurs, etc.)
  const MASKS = ["rouge", "orange", "jaune", "vert", "bleu", "indigo", "violet"];

  const maskMeta = {
    rouge:  { index: 0, start: 0,  label: "Masque Rouge ‚Äì Peur de la mort/de la maladie",    short: "Rouge",  color: "#E53935" },
    orange: { index: 1, start: 12, label: "Masque Orange ‚Äì Peur de la souffrance √©motionnelle", short: "Orange", color: "#FB8C00" },
    jaune:  { index: 2, start: 24, label: "Masque Jaune ‚Äì Peur de l‚Äôinconnu/de l‚Äôincertitude",  short: "Jaune",  color: "#FDD835" },
    vert:   { index: 3, start: 36, label: "Masque Vert ‚Äì Peur du rejet/de l‚Äôabandon",          short: "Vert",   color: "#43A047" },
    bleu:   { index: 4, start: 48, label: "Masque Bleu ‚Äì Peur de l‚Äôimpuissance/perte de contr√¥le", short: "Bleu",   color: "#1E88E5" },
    indigo: { index: 5, start: 60, label: "Masque Indigo ‚Äì Peur de l‚Äô√©chec (imposteur)",        short: "Indigo", color: "#5E35B1" },
    violet: { index: 6, start: 72, label: "Masque Violet ‚Äì Peur de perdre son identit√©",        short: "Violet", color: "#8E24AA" }
  };

  // 2. Questions invers√©es (√† compl√©ter avec les num√©ros REELS du questionnaire en ligne)
  // Exemple : si q5 et q37 sont invers√©es, √©crire : [5, 37]
  const INVERTED_QUESTIONS = [];

  // 3. √âtiquettes des questions (facultatif mais recommand√© pour des d√©fis plus parlants)
  // Cl√© = num√©ro de question (1‚Äì84), valeur = texte court de la question.
  // Exemple :
  // const QUESTION_LABELS = {
  //   1: "Je surveille constamment mes battements cardiaques, ma respiration ou ma temp√©rature corporelle",
  //   2: "...",
  //   ...
  // };
  const QUESTION_LABELS = {};

  // 4. Collecte des r√©ponses brutes (0‚Äì4) √† partir du DOM
  function collectResponses() {
    const responses = [];
    for (let i = 1; i <= 84; i++) {
      const input = document.querySelector(`input[name="q${i}"]:checked`);
      const value = input ? parseInt(input.value, 10) : 0;
      responses.push(isNaN(value) ? 0 : value);
    }
    return responses; // tableau de 84 nombres entre 0 et 4
  }

  // 5. Calcul des scores par masque (12 questions par masque)
  function calculateScores(responses) {
    const scores = {};
    MASKS.forEach(mask => {
      const start = maskMeta[mask].start; // index 0‚Äëbased
      let sum = 0;
      for (let i = 0; i < 12; i++) {
        sum += responses[start + i] || 0;
      }
      scores[mask] = sum; // 0‚Äì48
    });
    scores.total = MASKS.reduce((acc, m) => acc + scores[m], 0); // 0‚Äì336
    return scores;
  }

  // 6. Classification du niveau d‚Äôemprise (faible, mod√©r√©, √©lev√©, dominant)
  function getLevel(score) {
    if (score <= 12) {
      return {
        level: "faible",
        color: "#2E7D32",
        desc: "Pr√©sent de fa√ßon ponctuelle. Flexibilit√© √©motionnelle globalement pr√©serv√©e."
      };
    }
    if (score <= 24) {
      return {
        level: "mod√©r√©",
        color: "#FBC02D",
        desc: "Influence significative sur certains domaines de vie, mais encore modulable."
      };
    }
    if (score <= 36) {
      return {
        level: "√©lev√©",
        color: "#FB8C00",
        desc: "Emprise importante, ce masque guide de nombreuses d√©cisions et r√©actions."
      };
    }
    return {
      level: "dominant",
      color: "#C62828",
      desc: "Masque central actuellement. Gouverne fortement le fonctionnement quotidien."
    };
  }

  // 7. Score ajust√© d‚Äôune question (prise en compte des questions invers√©es)
  function getAdjustedItemScore(questionIndex, rawScore) {
    // questionIndex : 1‚Äì84 (base 1)
    if (INVERTED_QUESTIONS.includes(questionIndex)) {
      // Inversion 4‚Üî0, 3‚Üî1, 2‚Üî2
      return 4 - rawScore;
    }
    return rawScore;
  }

  // 8. G√©n√©ration des d√©fis progressifs V.A.L.E.U.R pour un masque donn√©
  function buildDefisForMask(maskKey, questionLabel) {
    const meta = maskMeta[maskKey];
    const nomMasque = meta.label;

    return [
      `D√©fi 1 ‚Äì Niveau d√©butant : Pendant une semaine, prenez simplement conscience des moments o√π "${questionLabel}" se manifeste, sans chercher √† changer quoi que ce soit. Notez o√π, quand et avec qui cela survient (V = Voir).`,
      `D√©fi 2 ‚Äì Niveau interm√©diaire : Lorsque "${questionLabel}" appara√Æt, prenez 3 √† 5 respirations lentes en portant attention aux sensations corporelles associ√©es, en les laissant exister sans lutte (A = Accueillir).`,
      `D√©fi 3 ‚Äì Niveau interm√©diaire avanc√© : √Ä t√™te repos√©e, d√©crivez par √©crit ce que ce comportement/peur prot√®ge r√©ellement et quelles √©motions il √©vite (L = Localiser dans le corps, E = Explorer l‚Äôorigine du conflit).`,
      `D√©fi 4 ‚Äì Niveau avanc√© : Choisissez une petite situation r√©elle o√π "${questionLabel}" se d√©clenche habituellement et exp√©rimentez une r√©ponse diff√©rente, plus align√©e avec vos besoins, tout en tol√©rant l‚Äôinconfort (U = Unifier avec votre part courageuse).`,
      `D√©fi 5 ‚Äì Niveau expert : Mettez en place un rituel hebdomadaire o√π vous choisissez consciemment une action concr√®te √† l‚Äôoppos√© du masque li√© √† "${questionLabel}" (par exemple, l√¢cher un contr√¥le, dire non, accepter un impr√©vu), puis notez les b√©n√©fices observ√©s (R = Renforcer).`
    ];
  }

  // 9. S√©lection des questions √† cibler et g√©n√©ration des d√©fis pour chaque masque
  function generateDefis(scores, responses) {
    const defisParMasque = {};

    MASKS.forEach(mask => {
      const start = maskMeta[mask].start; // 0‚Äëbased
      const items = [];

      for (let i = 0; i < 12; i++) {
        const globalIndex0 = start + i;     // 0‚Äëbased
        const globalIndex1 = globalIndex0 + 1; // 1‚Äëbased pour le mapping et l‚Äôinversion
        const raw = responses[globalIndex0] || 0;
        const adj = getAdjustedItemScore(globalIndex1, raw);

        items.push({
          questionIndex: globalIndex1,
          rawScore: raw,
          adjScore: adj
        });
      }

      // On s‚Äôint√©resse aux peurs les plus vives : adjScore 4 en priorit√©, puis 3
      items.sort((a, b) => b.adjScore - a.adjScore);
      const cibles = items.filter(it => it.adjScore >= 3);

      // On ne propose des d√©fis que si le masque n‚Äôest pas faible
      if (scores[mask] > 12 && cibles.length > 0) {
        const ciblePrincipale = cibles[0];
        const label = QUESTION_LABELS[ciblePrincipale.questionIndex] || `Question ${ciblePrincipale.questionIndex}`;
        defisParMasque[mask] = {
          questionLabel: label,
          adjScore: ciblePrincipale.adjScore,
          defis: buildDefisForMask(mask, label)
        };
      }
    });

    return defisParMasque;
  }

  // 10. Rendu HTML des scores + niveaux
  function buildScoresHtml(scores) {
    let html = "<h2>Vos scores par masque</h2>";
    html += "<table><thead><tr><th>Masque</th><th>Score / 48</th><th>Niveau</th></tr></thead><tbody>";

    MASKS.forEach(mask => {
      const score = scores[mask];
      const lvl = getLevel(score);
      const meta = maskMeta[mask];
      html += `
        <tr>
          <td><span style="font-weight:bold;color:${meta.color}">${meta.short}</span><br><small>${meta.label}</small></td>
          <td>${score} / 48</td>
          <td><span style="color:${lvl.color};font-weight:bold;text-transform:uppercase;">${lvl.level}</span><br><small>${lvl.desc}</small></td>
        </tr>
      `;
    });

    html += "</tbody></table>";

    html += `<p><strong>Score global :</strong> ${scores.total} / 336</p>`;

    return html;
  }

  // 11. Rendu HTML des d√©fis
  function buildDefisHtml(defisParMasque, scores) {
    let html = "<h2>D√©fis progressifs personnalis√©s</h2>";

    const masksWithDefis = MASKS.filter(m => defisParMasque[m]);
    if (masksWithDefis.length === 0) {
      html += "<p>Vos scores actuels indiquent une emprise plut√¥t faible des masques. Les d√©fis V.A.L.E.U.R peuvent √™tre travaill√©s avec un professionnel si vous le souhaitez.</p>";
      return html;
    }

    html += "<p>Les d√©fis ci‚Äëdessous sont construits √† partir des questions o√π la peur est la plus √©lev√©e (r√©ponse 4, ou 0 pour les questions invers√©es), afin de cibler en priorit√© ce qui maintient vos sch√©mas actuels.</p>";

    masksWithDefis.forEach(mask => {
      const bloc = defisParMasque[mask];
      const meta = maskMeta[mask];
      const score = scores[mask];
      const lvl = getLevel(score);

      html += `
        <details open>
          <summary>
            <strong style="color:${meta.color}">${meta.label}</strong>
            ‚Äì score ${score}/48 ‚Äì niveau : 
            <span style="color:${lvl.color};text-transform:uppercase;">${lvl.level}</span>
          </summary>
          <p><em>Question cibl√©e en priorit√© :</em> "${bloc.questionLabel}" (peur ressentie √† un niveau ${bloc.adjScore}/4).</p>
          <ol>
      `;

      bloc.defis.forEach(defi => {
        html += `>${defi}</li>`;
      });

      html += `
          </ol>
        </details>
      `;
    });

    return html;
  }

  // 12. Camembert des masques (Chart.js)
  let maskPieChart = null;

  function renderPieChart(scores) {
    const canvas = document.getElementById("maskPie");
    if (!canvas || typeof Chart === "undefined") {
      return; // Chart.js non charg√© ou canvas absent
    }

    const ctx = canvas.getContext("2d");
    const data = MASKS.map(m => scores[m]);
    const labels = MASKS.map(m => maskMeta[m].short);
    const colors = MASKS.map(m => maskMeta[m].color);

    if (maskPieChart) {
      maskPieChart.destroy();
    }

    maskPieChart = new Chart(ctx, {
      type: "pie",
      data: {
        labels: labels,
        datasets: [{
          data: data,
          backgroundColor: colors
        }]
      },
      options: {
        responsive: true,
        plugins: {
          legend: {
            position: "bottom"
          },
          tooltip: {
            callbacks: {
              label: function(context) {
                const label = context.label || "";
                const value = context.parsed || 0;
                return `${label} : ${value}/48`;
              }
            }
          }
        }
      }
    });
  }

  // 13. Contr√¥le principal √† la soumission du questionnaire
  function onSubmit(event) {
    event.preventDefault();

    const responses = collectResponses();
    const scores = calculateScores(responses);
    const defis = generateDefis(scores, responses);

    const container = document.getElementById("resultats");
    if (container) {
      let html = "";
      html += buildScoresHtml(scores);
      html += buildDefisHtml(defis, scores);
      container.innerHTML = html;
    }

    renderPieChart(scores);
  }

  // 14. Initialisation √† chargement du DOM
  document.addEventListener("DOMContentLoaded", function() {
    const form = document.getElementById("questionnaire-valeur");
    if (form) {
      form.addEventListener("submit", onSubmit);
    }
  });
})();

        </html>





	Sans virus.www.avg.com
